<!--<script src="//kodekloud.s3.amazonaws.com/sites/5438407c6e6f64462d020000/92b82a88144a6207ab1a5e8e0f63d3d1/craftmap.js"></script>-->
<style>
    .demo_1{
        height:650px;
        width:740px;
        margin: 0 auto;
    }
    .popup a:hover{
        text-decoration:none;
    }
    @media only screen and (max-width: 1030px) {
        .demo_1{
            width:600px;
        }
    }
    @media only screen and (max-width: 800px) { 
        .demo_1{
            height:400px;
            width:340px;
        }
    }
    @media only screen and (min-device-width : 320px) and (max-device-width : 568px) { 
        .demo_1{
            height:300px;
            width:300px;
        }
    }
    
    //map

.smooth_zoom_preloader {
	background-image: url(//codecloud.cdn.speedyrails.net/sites/54d4e9206e6f64691f000000/d9e054e28dd1bad70a952dd85777e93f/preloader.gif);
}	
.smooth_zoom_icons {
	background-image: url(//codecloud.cdn.speedyrails.net/sites/54d4e9206e6f64691f000000/d9e054e28dd1bad70a952dd85777e93f/icons.png);
}

#zoom_container .landmarks{
	position:absolute;
	z-index:10;	
	top:0px;
	left:0px;
	font-family: Helvetica, Arial, Verdana;
	font-size:12px;
	color: #ffffff;
}	
#zoom_container .landmarks .item {
	position:absolute;		
	text-align:center;		
	/*display: none;	*/
}	
#zoom_container .landmarks .lable div {
	width: 100px;
	padding: 4px;		
}	
#zoom_container .landmarks .mark {
    background-color: transparent;
}
#zoom_container .landmarks .mark .text{
	background-color:transparent;
	padding:2px 6px;
}	

.mark a{
    color:black;
    display:none;
}

#zoom_container .landmarks .mark .text {
    background-color: #6e6e6e;
    padding: 10px;
    width: 150px;
    border-radius: 5px;
    margin-bottom: 10px;
    padding-top: 12px;
}
</style>
<div class="container-fluid container_60">
    <div class="row">
        <div class="col-md-3">
            <div class="show_phone">
                <h1>Centre Map</h1>
                <div class="line"></div>
                <p class="mini_nav">
                    <a href="/stores">STORE LIST</a>
                    <a class="active" href="/map">CENTRE MAP</a>
                    <a href="/new_stores">NEW STORES</a>
                    <a href="/promotions">PROMOTIONS</a>
                </p>
            </div>
            <div class="map_store_list" id="store_list_container">
                <script id="store_list_template" type="x-tmpl-mustache/text">
                    <p class="store_initial" style="{{show}}" id="{{initial}}">{{initial}}</p>
                    <p class="store_name"><a class="map_pin_a" href="#" data-value='{{x_coordinate}},{{y_coordinate}},{{id}}'>{{name}}</a></p>
                </script>
            </div>
        </div>
        <!--<div class="col-md-1 hidden_phone">-->
        <!--    <div style="width:50%;border-right:1px solid #ccc;height:100%" id="mid_div"></div>-->
        <!--</div>-->
        <div class="col-md-8 left_pad">
            <div class="hidden_phone">
                <h1>Centre Map</h1>
                <div class="line"></div>
                <p class="mini_nav">
                    <a href="/stores">STORE LIST</a>
                    <a class="active" href="/map">CENTRE MAP</a>
                    <a href="/new_stores">NEW STORES</a>
                    <a href="/promotions">PROMOTIONS</a>
                </p>
            </div>
            <div class="map">
                <div id="zoom_container">
                    <img id="png_map" class="png_map" alt="center map" src="" />
                    <div class="landmarks" data-show-at-zoom="100" data-allow-drag="true"></div>    
                </div>
            </div>
        </div>
    </div>
</div>
<script src="//kodekloud.s3.amazonaws.com/sites/54d4e9206e6f64691f000000/d9e054e28dd1bad70a952dd85777e93f/jquery.smoothZoom.min.js"></script>
<script>
    function show_pin(param){
		store_id = $(param).attr('store_id');
		console.log(store_id)
		if($("#"+store_id).is(":visible")){
			$("."+store_id).hide();				
			$("#"+store_id).hide();
			$("#no_pin_"+store_id).show();
			$("#show_pin_"+store_id).hide();
			$("#m_no_pin_"+store_id).show();
			$("#m_show_pin_"+store_id).hide();
		}else{
			$(".marker").hide();
			$("#"+store_id).show();
			$("#"+store_id).click();
			$("#no_pin_"+store_id).hide();
			$("#show_pin_"+store_id).show();
			$("#m_no_pin_"+store_id).hide();
			$("#m_show_pin_"+store_id).show();
		}
		$('#store_table').hide()
		
		return false;
    }
    $(function(){
        $("#map_button").click(function(){
            $("#store_table").toggle();
        });
        
    });
    function hide_table(){
        $("#store_table").hide();
        show_table = false;
    }
    $(document).ready(function(e) {
        init(e);
        function renderAll(){
            init_home_hours();
            var stores = getStoresList();
            renderStoreList('#store_list_container','#store_list_template', stores, "stores", "A", "Z");
            show_content();    
            
            $("#png_map").attr("src", getPNGMapURL())
    		$('#png_map').smoothZoom({
    		    height: 1650,
    		    width: 1636,
    		    initial_ZOOM: 0,
    			zoom_MIN: 0,
    			zoom_MAX: 100,
    			responsive: true,
    		    responsive_maintain_ratio: true,
    			zoom_BUTTONS_SHOW : 'YES',
    			pan_BUTTONS_SHOW : 'NO',
    			pan_LIMIT_BOUNDARY : 'NO',
    			button_ALIGN: "top left",
    			container: 'zoom_container'
    		});
		
		    show_png_pin(".map_pin_a", "#png_map");
        }
        loadMallDataCached(renderAll); 
        
        function show_png_pin(trigger, map){
            $(trigger).click(function(e) {
                e.preventDefault()
                var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) );
                coords = $(this).attr('data-value').split(",");
                var zoomData = $(map).smoothZoom('getZoomData');
                x_coord = parseInt(coords[0])
                y_coord = parseInt(coords[1])
                floor = (coords[3])
                
                name = $(this).text();
                $(map).smoothZoom('removeLandmark')
                if (isMobile) {
                    $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:200});    
                } else {
                    $(map).smoothZoom('focusTo', {x:x_coord, y:y_coord, zoom:300});
                }
                
                $(map).smoothZoom('addLandmark', 
        			[
        			'<div class="item mark" data-show-at-zoom="0" data-position="'+x_coord+','+y_coord+'">\
        				<div>\
        					<div class="text">\
        					<strong>'+ name+ '</strong>\
        				</div>\
        				<img src="//kodekloud.s3.amazonaws.com/sites/5438407c6e6f64462d020000/7760d28d65f477cd66bd4756f9204c15/map_pin2.png" width="45px" height="65px" alt="marker" />\
        				</div>\
        			</div>'
        			]
        		);
            });
        }
    })
    
    // $('#map_image').after('<div class="marker" id="store_' + val.id  + '" data-coords="' + x + ', ' + y + '" style="display:none"><a style="color:#fff" href=/stores/'+val.slug +'>' + val.name + '</a></div>')
</script>